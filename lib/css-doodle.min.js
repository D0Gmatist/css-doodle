!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define(t):t()}(0,function(){"use strict";function e(e){return Array.isArray(e)?e:Object.keys(e).map(t=>e[t])}function t(t,...n){return n.reduce((t,n)=>t.apply(null,e(n)),t)}function n(e){return(e||[]).join("\n")}function r(e){return Array.isArray(e)?e:[e]}function s(e,t,n){return Math.max(t,Math.min(n,e))}function i(e){return`-webkit-${e}${e}`}function u(e,t){return function(...n){let r=e+n.join("-");return q[r]?q[r]:q[r]=t.apply(null,n)}}function o(...e){let t=e.reduce((e,t)=>e.concat(t),[]);return t[Math.floor(Math.random()*t.length)]}function c(e,t,n){let r=0,s=e=>e>0&&e<1?.1:1,i=arguments.length;1==i&&([e,t]=[s(e),e]),i<3&&(n=s(e));let u=[];for(;(n>0&&e<t||n<0&&e>t)&&(u.push(e),e+=n,!(r++>=1e3)););return u}function l(e){return function(...t){let n=p(t[0]);return n?(t=t.map(f),a(e,n).apply(null,t)):e.apply(null,t)}}function a(e,t){return function(...n){n=n.map(f);let r=e.apply(null,n);return t&&(r=r.map(e=>e+t)),r}}function p(e){if(!e)return"";let t=/(%|cm|fr|rem|em|ex|in|mm|pc|pt|px|vh|vw|vmax|vmin|deg|ms|s)$/,n="".trim.call(e).match(t);return n?n[0]:""}function f(e){let t=p(e);return t?+e.replace(t,""):e}function h(e,t){"function"==typeof arguments[0]&&(t=e,e={}),t||(t=(e=>[B(e),P(e)]));for(var n=e.split||120,r=e.scale||1,s=Z*(e.start||0),i=e.deg?e.deg*Z:X/(n/2),u=[],o=0;o<n;++o){var c=s+i*o,[l,a]=t(c);u.push(50*l*r+50+"% "+(50*a*r+50)+"%")}return`polygon(${u.join(",")})`}function d(e,t,n){var r=Z*n;return[e*B(r)-t*P(r),t*B(r)+e*P(r)]}function m(e=3){var t=1-(e=s(e,3,6));return h({scale:1/e},n=>{var r=t*B(n)+B(t*(n-X)),s=t*P(n)+P(t*(n-X));return 3==e&&(r=1.1*r-.6,s*=1.1),[r,s]})}function y(){return function(...e){return o.apply(null,e)}}function v(e,t){for(var n=new K(e),r=1,s=0;r<=t.x;++r)for(var i=1;i<=t.y;++i)n.compose({x:r,y:i,count:++s});return n.output()}function g(e){var t=0,n=1,r=1;return{curr:(n=0)=>e[t+n],end:()=>e.length<=t,info:()=>({index:t,col:n,line:r}),next:()=>{var s=e[t++];return"\n"==s?(r++,n=0):n++,s}}}function x(e,{col:t,line:n}){throw new Error(`(at line ${n}, column ${t}) ${e}`)}function b(e){return e.trim().length?V.number(+e)?+e:e.trim():e}function _(e){var[t,n]=[e.curr(),e.curr()],r=V.close_bracket_of(n);for(e.next();!e.end();){if(r(n=e.curr())){t+=n;break}V.open_bracket(n)?t+=_(e):t+=n,e.next()}return t}function w(e,t={}){var n=Q.comment(),r=e.curr();for("#"!=r&&e.next(),e.next();!e.end()&&("*"!=(r=e.curr())||"/"!=e.curr(1));){if(n.value+=r,r=e.curr(),t.inline){if("\n"==r)return n}else if("*"==r&&"/"==e.curr(1))break;n.value+=r,e.next()}return e.next(),e.next(),n}function k(e){for(var t,n="";!e.end()&&":"!=(t=e.curr());)/[a-zA-Z\-]/.test(t)?V.white_space(t)||(n+=t):x("Syntax error:Bad property name.",e.info()),e.next();return n}function $(e,t){var n,r="";for(e.next();!e.end();){if((n=e.curr())==t){if("\\"!==e.curr(-1))break;r+=n}else r+=n;e.next()}return r}function z(e){for(var t,n=[],r=[],s="";!e.end();){if(V.open_bracket(t=e.curr()))s+=_(e);else if(/['"]/.test(t))s+=$(e,t);else if("@"==t)r.length||(s=s.trimLeft()),s.length&&(r.push(Q.text(s)),s=""),r.push(j(e));else if(/[,)]/.test(t)){if(s.length&&(r.length?(s=s.trimRight()).length&&r.push(Q.text(s)):r.push(Q.text(b(s)))),n.push(r.slice()),[r,s]=[[],""],")"==t)break}else s+=t;e.next()}return n}function j(e){for(var t,n=Q.func(),r="";!e.end()&&")"!=(t=e.curr());){if("("==t){e.next(),n.name=r,n.arguments=z(e);break}r+=t,e.next()}return n}function M(e){var t,n=Q.text();const r=[];for(;!e.end();)if("\n"!=(t=e.curr())){if(/[;}]/.test(t)){n.value.length&&r.push(n),n=Q.text();break}"@"==t?(n.value.length&&r.push(n),n=Q.text(),r.push(j(e))):V.white_space(t)&&V.white_space(e.curr(-1))||(":"==t&&x("Syntax error:Bad property name.",e.info()),n.value+=t),e.next()}else e.next();return n.value.length&&r.push(n),r.length&&r[0].value&&(r[0].value=r[0].value.trimLeft()),r}function T(e){for(var t,n="";!e.end()&&"{"!=(t=e.curr());)V.white_space(t)||(n+=t),e.next();return n}function L(e){for(var t,n={name:"",arguments:[]};!e.end();){if("("==(t=e.curr()))e.next(),n.arguments=z(e);else{if(/[){]/.test(t))break;V.white_space(t)||(n.name+=t)}e.next()}return n}function A(e){for(var t,n=Q.psudo();!e.end()&&"}"!=(t=e.curr());)if(V.white_space(t))e.next();else{if(n.selector){if(n.styles.push(O(e)),"}"==e.curr())break}else n.selector=T(e);e.next()}return n}function O(e){for(var t=Q.rule();!e.end()&&";"!=e.curr();){if(t.property.length){t.value=M(e);break}t.property=k(e),e.next()}return t}function H(e){for(var t,n=Q.cond();!e.end()&&"}"!=(t=e.curr());){if(n.name.length){if(":"==t){var r=A(e);r.selector&&n.styles.push(r)}else if("@"==t)n.styles.push(H(e));else if(!V.white_space(t)){var s=O(e);if(s.property&&n.styles.push(s),"}"==e.curr())break}}else Object.assign(n,L(e));e.next()}return n}function E(e){const t=g(e),n=[];for(;!t.end();){var r=t.curr();if(V.white_space(r))t.next();else{if("/"==r&&"*"==t.curr(1))n.push(w(t));else if("#"==r||"/"==r&&"/"==t.curr(1))n.push(w(t,{inline:!0}));else if(":"==r){var s=A(t);s.selector&&n.push(s)}else if("@"==r){var i=H(t);i.name.length&&n.push(i)}else if(!V.white_space(r)){var u=O(t);u.property&&n.push(u)}t.next()}}return n}function S(e,t){return v(E(e),t)}function C(e){let[t,n]=(e+"").replace(/\s+/g,"").replace(/[,，xX]+/,"x").split("x").map(Number);const r={x:s(t||Y,1,ee),y:s(n||t||Y,1,ee)};return Object.assign({},r,{count:r.x*r.y})}var N={even:e=>!!(e%2),odd:e=>!(e%2)},W=Object.freeze({nth:function(e,t,n){return e=>e==n},at:function(e,t){return(n,r)=>e==n&&t==r},row:function(e,t,n){return t=>/^(even|odd)$/.test(t)?N[t](e-1):t==e},col:function(e,t,n){return e=>/^(even|odd)$/.test(e)?N[e](t-1):e==t},even:function(e,t,n){return e=>N.even(n-1)},odd:function(e,t,n){return e=>N.odd(n-1)}});const q={},{cos:B,sin:P,sqrt:R,pow:I,PI:X}=Math,Z=X/180;var D=Object.freeze({circle:function(){return"circle(49%)"},triangle:function(){return h({split:3,start:-90},e=>[1.1*B(e),1.1*P(e)+.2])},rhombus:function(){return h({split:4})},pentagon:function(){return h({split:5,start:54})},hexgon:function(){return h({split:6,start:30})},hexagon:function(){return h({split:6,start:30})},heptagon:function(){return h({split:7,start:-90})},octagon:function(){return h({split:8})},star:function(){return h({split:5,start:54,deg:144})},diamond:function(){return"polygon(50% 5%, 80% 50%, 50% 95%, 20% 50%)"},cross:function(){return`polygon(\n 5% 35%, 35% 35%, 35% 5%, 65% 5%,\n 65% 35%, 95% 35%, 95% 65%, 65% 65%,\n 65% 95%, 35% 95%, 35% 65%, 5% 65%\n )`},clover:function(e=3){return 4==(e=s(e,3,5))&&(e=2),h({split:240},t=>{var n=B(e*t)*B(t),r=B(e*t)*P(t);return 3==e&&(n-=.2),2==e&&(n/=1.1,r/=1.1),[n,r]})},hypocycloid:m,astroid:function(){return m(4)},infinity:function(){return h(e=>{var t=.7*R(2)*B(e),n=I(P(e),2)+1;return[t/n,t*P(e)/n]})},heart:function(){return h(e=>d(.75*I(P(e),3)*1.2,1.1*(B(1*e)*(13/18)-B(2*e)*(5/18)-B(3*e)/18-B(4*e)/18+.2),180))},bean:function(){return h(e=>{var[t,n]=[I(P(e),3),I(B(e),3)];return d((t+n)*B(e)*1.3-.45,(t+n)*P(e)*1.3-.45,-90)})},bicorn:function(){return h(e=>d(B(e),I(P(e),2)/(2+P(e))-.5,180))},pear:function(){return h(e=>[P(e),(1+P(e))*B(e)/1.4])},fish:function(){return h(e=>[B(e)-I(P(e),2)/R(2),P(2*e)/2])},whale:function(){return h({split:240},e=>{var t=3.4*(I(P(e),2)-.5)*B(e);return d(B(e)*t+.75,P(e)*t*1.2,180)})},bud:function(e=3){return e=s(e,3,10),h({split:240},t=>[(1+.2*B(e*t))*B(t)*.8,(1+.2*B(e*t))*P(t)*.8])}}),F=Object.freeze({index:function(e,t,n){return e=>n},row:function(e,t,n){return t=>e},col:function(e,t,n){return e=>t},any:y,pick:function(){return y.apply(null,arguments)},rand:function(){return function(...e){return o(u("range",l(c)).apply(null,e))}},shape:function(e,t,n){return u("shape",function(e,...t){if(e&&(e=e.trim(),D[e]))return D[e].apply(null,t)})}});const G=/[,，\/\s]+\s*/;var J={["size"](e){var[t,n=t]=e.split(G);return`width:${t};height:${n};`},["min-size"](e){var[t,n=t]=e.split(G);return`min-width:${t};min-height:${n};`},["max-size"](e){var[t,n=t]=e.split(G);return`max-width:${t};max-height:${n};`}};class K{constructor(e){this.tokens=e,this.rules={},this.props={},this.styles={host:"",cells:""}}add_rule(e,t){var n=this.rules[e];n||(n=this.rules[e]=[]),n.push.apply(n,r(t))}compose_selector(e,t=""){return`.cell:nth-of-type(${e})${t}`}compose_argument(e,n){var r=e.map(e=>{if("text"==e.type)return e.value;if("func"==e.type){var r=F[e.name.substr(1)];if(r){var s=e.arguments.map(e=>this.compose_argument(e,n));return t(r,n,s)}}});return r.length>2?r.join(""):r[0]}compose_value(e,n){return e.reduce((e,r)=>{switch(r.type){case"text":e+=r.value;break;case"func":var s=F[r.name.substr(1)];if(s){var i=r.arguments.map(e=>this.compose_argument(e,n));e+=t(s,n,i)}}return e},"")}compose_rule(e,t){var n=e.property,r=this.compose_value(e.value,t);"transition"==n&&(this.props.has_transition=!0);var s=`${n}:${r};`;return"clip-path"==n&&(s=i(s),s+=";overflow:hidden;"),J[n]&&(s=J[n](r)),s}compose(e,n){(n||this.tokens).forEach((n,r)=>{if(n.skip)return!1;switch(n.type){case"rule":this.add_rule(this.compose_selector(e.count),this.compose_rule(n,e));break;case"psudo":n.selector.startsWith(":doodle")&&(n.selector=n.selector.replace(/^\:+doodle/,":host"));var s=n.selector.startsWith(":host");s&&(n.skip=!0);var i=n.styles.map(t=>this.compose_rule(t,e)),u=s?n.selector:this.compose_selector(e.count,n.selector);this.add_rule(u,i);break;case"cond":var o=W[n.name.substr(1)];if(o){var c=n.arguments.map(t=>this.compose_argument(t,e));t(o,e,c)&&this.compose(e,n.styles)}}})}output(){return Object.keys(this.rules).forEach(e=>{const t=e.startsWith(":host")?"host":"cells";this.styles[t]+=`\n ${e}{${n(this.rules[e])}}`}),{props:this.props,styles:this.styles}}}const Q={func:(e="")=>({type:"func",name:e,arguments:[]}),argument:()=>({type:"argument",value:[]}),text:(e="")=>({type:"text",value:e}),comment:e=>({type:"comment",value:e}),psudo:(e="")=>({type:"psudo",selector:e,styles:[]}),cond:(e="")=>({type:"cond",name:e,styles:[],arguments:[]}),rule:(e="")=>({type:"rule",property:e,value:[]})},U={"(":")","[":"]","{":"}"},V={white_space:e=>/[\s\n\t]/.test(e),open_bracket:e=>U.hasOwnProperty(e),close_bracket_of(e){var t=U[e];return e=>e==t},number:e=>!isNaN(e)},Y=1,ee=16,te=`\n:host{display:block;visibility:visible;width:1em;height:1em;}.container{position:relative;width:100%;height:100%;display:grid;}.cell{position:relative;line-height:1;box-sizing:border-box;display:flex;justify-content:center;align-items:center;}`;class ne extends HTMLElement{constructor(){super(),this.doodle=this.attachShadow({mode:"open"})}connectedCallback(){setTimeout(()=>{if(!this.innerHTML.trim())return!1;let e;try{e=S(this.innerHTML,this.size=C(this.getAttribute("grid")))}catch(e){throw this.innerHTML="",new Error(e)}const{has_transition:t}=e.props;this.doodle.innerHTML=`\n<style>${te}</style><style class="style-container">${this.style_size()}${e.styles.host}</style><style class="style-cells">${t?"":e.styles.cells}</style><div class="container">${this.html_cells()}</div>`,t&&setTimeout(()=>{this.set_style(".style-cells",e.styles.cells)},50)})}style_size(){return`\n .container{grid-template-rows:repeat(${this.size.x}, 1fr);grid-template-columns:repeat(${this.size.y}, 1fr);}`}html_cells(){return'<div class="cell"></div>'.repeat(this.size.count)}set_style(e,t){const n=this.shadowRoot.querySelector(e);n&&(n.styleSheet?n.styleSheet.cssText=t:n.innerHTML=t)}update(e){if(!e)return!1;this.size||(this.size=C(this.getAttribute("grid")));const t=S(e,this.size);this.set_style(".style-container",this.style_size()+t.styles.host),this.set_style(".style-cells",t.styles.cells),this.innerHTML=e}refresh(){this.update(this.innerHTML)}get grid(){return Object.assign({},this.size)}set grid(e){this.setAttribute("grid",e),this.connectedCallback()}static get observedAttributes(){return["grid"]}attributeChangedCallback(e,t,n){"grid"==e&&t&&t!==n&&(this.grid=n)}}customElements.define("css-doodle",ne)});